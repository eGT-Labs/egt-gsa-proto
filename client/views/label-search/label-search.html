<form class="form">
  <input autofocus class="form-control input-lg col-md-6" ng-model="vm.search.fulltext"
         placeholder="Search fulltext drug labels...">
  <button id="searchButton" class="btn btn-primary btn-lg" ng-click="vm.newSearch()">
    Search
  </button>
</form>




<div class="row">
  <div class="col-sm-4">

    <h3 ng-if="vm.selectedFacets.length">
      Selected Facets
    </h3>


    <div ng-repeat="facet in vm.selectedFacets">

      {{facet.label}}:

      <a ng-click="vm.removeFacet(facet.fieldName)">
        <span class="label label-primary">
          {{facet.value}}
        <span style="color:red" class="glyphicon glyphicon-remove"></span>
        </span>
      </a>
    </div>


    <h3>Available Facets</h3>

    <form class="form-inline" ng-init="isAlpha=false">
      <div class="form-group">
        <label for="sortToggle">Sort Facets by:</label>
        <!--<input type="text" class="form-control" id="exampleInputName2" placeholder="Jane Doe">-->
        <div class="btn-group" id="sortToggle">
          <label class="btn btn-default btn-xs" ng-model="isAlpha" btn-radio="false">Count</label>
          <label class="btn btn-default btn-xs" ng-model="isAlpha" btn-radio="true">Alphabetically</label>
        </div>
      </div>
    </form>

    <accordion close-others="false">
      <div ng-repeat="(facetKey, facet) in vm.facets">
      <accordion-group ng-if="vm.shouldListInAvailableFacets(facetKey)" is-open="facet.isOpen">
        <accordion-heading>
          <div>
            {{facet.label}}
            <small ng-if="!facet.isOpen">({{facet.data.length}})</small>
            <span class="glyphicon pull-right"
                  ng-class="{'glyphicon-resize-full': !facet.isOpen, 'glyphicon-resize-small': facet.isOpen}"></span>
          </div>
        </accordion-heading>
        <!--<ul class="list-group" >-->
        <div style="max-height: 400px; overflow-y: auto">
          <div  ng-repeat="facetInstance in facet.data | orderBy : (isAlpha ? 'term' : 'count') : !isAlpha" style="padding-bottom: 2px;"> 
            <a ng-click="vm.setFacet(facetKey, facetInstance.term)" >
              <span class="badge pull-right">{{facetInstance.count | number}}</span>
              {{facetInstance.term}}
            </a>
          </div>
        </div>
        <!--</ul>-->

      </accordion-group>
      </div>
    </accordion>
  </div>


  <div class="col-sm-8">
    <section id="loading" ng-if="!(vm.resp || vm.error)">
      <h1>Loading...</h1>
    </section>

    <section id="error" ng-if="vm.error">
      <h1>Error</h1>
      {{vm.error.error.message}}
    </section>

    <section id="mainResults" ng-if="vm.resp" >
      <div>
        Total Results: {{vm.resp.data.meta.results.total | number}}
      </div>

      <pagination
        boundary-links="true" class="pagination-sm" max-size="10"
        total-items="vm.resp.data.meta.results.total" items-per-age="vm.query.pageSize" ng-model="vm.query.pageNum"
        ng-change="vm.executeQuery()">
      </pagination>

		<div class="container" style="width: 970px;" href="/label/{{row.openfda.spl_id[0]}}">
			<div class="row">
				<div data-ng-repeat="row in vm.resp.data.results" class="thumbnail col-md-12">
					<div class="col-md-5">
						<p  ng-repeat="brand_name in row.openfda.brand_name track by $index"> 
								BrandName: 
							<a style="cursor: pointer" ng-click="vm.setFacet('brand_name', brand_name)">
								{{brand_name}}
						    </a>
						</p>
						Generic Name: 
						<p ng-repeat="generic_name in row.openfda.generic_name track by $index">
							<a style="cursor: pointer" ng-click="vm.setFacet('generic_name', generic_name)">
								{{generic_name}}
							</a>
						</p>
						<p ng-if=row.openfda.pharm_class_cs>
							Chemical Structure:
						<span ng-repeat="pharm_class_cs in row.openfda.pharm_class_cs track by $index">
							<a style="cursor: pointer" ng-click="vm.setFacet('pharm_class_cs', pharm_class_cs">
								{{pharm_class_cs}} <span ng-show='$index < row.openfda.pharm_class_cs.length-1'>,</span>
							</a>
						</span>
						</p>
					</div>
					<div class="col-md-5">
						<p ng-repeat="manufacturer_name in row.openfda.manufacturer_name track by $index">
						 		Manufacturer Name:
						 	<a style="cursor: pointer" ng-click="vm.setFacet('manufacturer_name', manufacturer_name)">
						 		 {{manufacturer_name}}
						 	</a>
						</p>
						<p  ng-if=row.openfda.substance_name>
							Ingredients:
							<span ng-repeat="substance in row.openfda.substance_name track by $index">
								<a style="cursor: pointer" ng-click="vm.setFacet('substance', substance)">
									 {{substance}} <span ng-show='$index < row.openfda.substance_name.length-1'>,</span>
								</a>	
							</span>
						</p>
						<p ng-if=row.openfda.pharm_class_moa>
							Method of Action:
						<span ng-repeat="pharm_class_moa in row.openfda.pharm_class_moa track by $index">
							<a style="cursor: pointer" ng-click="vm.setFacet('pharm_class_moa', pharm_class_moa">
								{{pharm_class_moa}} <span ng-show='$index < row.openfda.pharm_class_moa.length-1'>,</span>
							</a>
						</span>
						</p>
						<p ng-if=row.openfda.pharm_class_epc>
							Established Pharmacologic Class:
						<span ng-repeat="pharm_class_epc in row.openfda.pharm_class_epc track by $index">
							<a style="cursor: pointer" ng-click="vm.setFacet('pharm_class_epc', pharm_class_epc">
								{{pharm_class_epc}} <span ng-show='$index < row.openfda.pharm_class_moa.length-1'>,</span>
							</a>
						</span>
						</p>
					</div>
					<div class="col-md-2">
						<span ng-if="row.openfda.product_type[0].includes('PRESCRIPTION')" style="cursor: pointer; font-size: 15px;" class="badge alert-info"
								tooltip={{row.openfda.product_type[0]}}>&#x211E
						</span>
						<span ng-if="row.openfda.product_type[0].includes('OTC')" style="cursor: pointer; font-size: 15px;" class="badge alert-info"
								tooltip={{row.openfda.product_type[0]}}>OTC
						</span>
						<span ng-if=row.boxed_warning style="cursor: pointer; font-size: 15px;" class="badge alert-danger pull-right" popover-placement="left"
								popover={{row.boxed_warning[0]}}>Warning!
						</span>
						<a class="pull-down" href="/label/{{row.openfda.spl_id[0]}}">
							<h5><strong>Show details</strong></h5>
						</a>						
					</div>
				</div>										
			</div>
		</div>


		<pagination boundary-links="true" class="pagination-sm"
			max-size="10" total-items="vm.resp.data.meta.results.total"
			items-per-age="vm.query.pageSize" ng-model="vm.query.pageNum"
			ng-change="vm.executeQuery()"> </pagination>
		</section>
  </div>


</div>


<button class="btn btn-default" ng-click="jsonHidden = !jsonHidden">Show raw JSON</button>
<div collapse="!jsonHidden">
      <pre>
  {{vm.respText}}
      </pre>
</div>


